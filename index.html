<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zom</title>
<style>
body {margin:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#f0f0f0;color:#000;display:flex;flex-direction:column;height:100vh;}
header {background:#fff;color:#000;padding:15px;text-align:center;font-size:1.5em;font-weight:bold;}
main {flex:1;overflow-y:auto;padding:10px;}
.post {background-color:#fff;border-radius:15px;margin-bottom:15px;box-shadow:0 3px 10px rgba(0,0,0,0.2);border:2px solid #000;display:flex;flex-direction:column;overflow:hidden;}
.post-header {font-weight:bold;padding:10px;border-bottom:1px solid #ccc;}
.post-content {padding:10px;overflow-y:auto;flex:1;}
.post-footer {display:flex;justify-content:space-between;align-items:center;padding:10px;background-color:rgba(0,0,0,0.05);}
.post-footer button {border:none;background:transparent;cursor:pointer;display:flex;align-items:center;gap:5px;font-size:1em;transition:0.2s;color:black;}
.post-footer button:hover{transform:scale(1.1);}
#writePostContainer{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);width:90%;background:#fff;padding:10px 15px;box-shadow:0 -3px 10px rgba(0,0,0,0.2);border-radius:15px;display:none;gap:10px;z-index:100;border:2px solid #000;}
#writePostContainer textarea{flex:1;height:40px;padding:10px 12px;border-radius:12px;border:1px solid #ccc;resize:none;font-size:1em;outline:none;}
#writePostContainer button{padding:8px 15px;border:none;border-radius:12px;background-color:#000;color:#fff;font-weight:bold;cursor:pointer;font-size:0.9em;transition:0.2s;}
#writePostContainer button:hover{transform:scale(1.05);}
#topButtonsContainer{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:15px;padding:10px;border:2px solid #000;border-radius:30px;background-color:#fff;box-shadow:0 3px 6px rgba(0,0,0,0.2);z-index:100;}
.button-wrapper button{width:100px;height:50px;border:2px solid #000;border-radius:25px;background-color:#fff;color:#000;font-weight:bold;cursor:pointer;transition:0.2s;}
.button-wrapper button:hover{background-color:#000;color:#fff;transform:scale(1.05);}
#commentModal{display:none;position:fixed;z-index:200;left:0;top:0;width:100%;height:100%;backdrop-filter:blur(8px);background-color:rgba(0,0,0,0.2);justify-content:center;align-items:center;}
#commentModal .modal-content{background-color:rgba(255,255,255,0.95);color:black;padding:0;border-radius:20px;max-width:500px;width:90%;height:60%;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 8px 25px rgba(0,0,0,0.2);}
.modal-header{padding:15px;font-weight:bold;display:flex;justify-content:space-between;align-items:center;background-color:rgba(255,255,255,1);border-bottom:1px solid rgba(0,0,0,0.2);}
.close{font-size:1.5em;cursor:pointer;color:black;}
.modal-body{flex:1;padding:15px;overflow-y:auto;background-color:rgba(255,255,255,0.9);color:black;}
.comment{border-bottom:1px solid rgba(0,0,0,0.1);padding:8px 0;}
.comment strong{margin-right:5px;color:black;}
.modal-footer{padding:10px 15px;display:flex;gap:10px;border-top:1px solid rgba(0,0,0,0.2);background-color:rgba(255,255,255,0.95);}
.modal-footer input{flex:1;border-radius:20px;padding:10px 15px;border:1px solid rgba(0,0,0,0.2);background-color:rgba(255,255,255,0.8);color:black;}
.modal-footer input::placeholder{color:rgba(0,0,0,0.5);}
.modal-footer button{border-radius:20px;padding:10px 20px;background-color:black;color:white;font-weight:bold;cursor:pointer;border:none;}
button svg{width:20px;height:20px;vertical-align:middle;fill:black;}
#loginContainer,#registerContainer,#accountPage,#searchContainer{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.95);display:flex;justify-content:center;align-items:center;flex-direction:column;z-index:300;overflow-y:auto;}
#loginContainer input,#registerContainer input,#searchContainer input{padding:10px 15px;margin:5px 0;border-radius:12px;border:1px solid #ccc;width:250px;}
#loginContainer button,#registerContainer button{padding:10px 20px;margin-top:10px;border-radius:12px;border:none;background-color:black;color:white;cursor:pointer;}
#loginContainer button:hover,#registerContainer button:hover{transform:scale(1.05);}
#accountPostsContainer,#searchResults{width:90%;max-width:500px;}
</style>
</head>
<body>

<header>Zom</header>
<main id="postsContainer"></main>

<div id="writePostContainer">
<textarea id="postInput" placeholder="Ø§ÙƒØªØ¨ Ù…Ù†Ø´ÙˆØ±Ùƒ Ù‡Ù†Ø§..."></textarea>
<button id="publishBtn">Ù†Ø´Ø±</button>
</div>

<div id="topButtonsContainer">
<div class="button-wrapper"><button id="newPostBtn">Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</button></div>
<div class="button-wrapper"><button id="myAccountBtn">Ø­Ø³Ø§Ø¨ÙŠ</button></div>
<div class="button-wrapper"><button id="searchBtn">Ø¨Ø­Ø«</button></div>
</div>

<div id="commentModal">
<div class="modal-content">
<div class="modal-header">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª <span class="close" id="closeModal">&times;</span></div>
<div class="modal-body" id="modal-comments"></div>
<div class="modal-footer">
<input type="text" id="modal-comment-input" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚...">
<button id="modal-comment-btn">ØªØ¹Ù„ÙŠÙ‚</button>
</div>
</div>
</div>

<div id="loginContainer">
<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
<input type="text" id="loginPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
<p>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span id="showRegister" style="color:blue;cursor:pointer">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</span></p>
</div>

<div id="registerContainer" style="display:none;">
<h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
<input type="text" id="registerPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<input type="password" id="registerPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<input type="text" id="registerUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<button id="registerBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
<p>Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span id="showLogin" style="color:blue;cursor:pointer">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span></p>
</div>

<div id="accountPage">
<h2>Ø­Ø³Ø§Ø¨ÙŠ</h2>
<div id="accountPostsContainer"></div>
</div>

<div id="searchContainer">
<input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<div id="searchResults"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, update, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";

const firebaseConfig = {
apiKey:"AIzaSyDVYoWats4bhKLbO8cu9hQ73WBjty-e5mA",
authDomain:"aljj-28d36.firebaseapp.com",
databaseURL:"https://aljj-28d36-default-rtdb.firebaseio.com",
projectId:"aljj-28d36",
storageBucket:"aljj-28d36.firebasestorage.app",
messagingSenderId:"256012982420",
appId:"1:256012982420:web:3a1541af04b99d658e7c81",
measurementId:"G-43WH1GKJFC"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getDatabase(app);

const postsContainer=document.getElementById('postsContainer');
const newPostBtn=document.getElementById('newPostBtn');
const writePostContainer=document.getElementById('writePostContainer');
const publishBtn=document.getElementById('publishBtn');
const postInput=document.getElementById('postInput');
const commentModal=document.getElementById('commentModal');
const modalComments=document.getElementById('modal-comments');
const modalCommentInput=document.getElementById('modal-comment-input');
const modalCommentBtn=document.getElementById('modal-comment-btn');
const closeModal=document.getElementById('closeModal');

const loginContainer=document.getElementById('loginContainer');
const registerContainer=document.getElementById('registerContainer');
const loginBtn=document.getElementById('loginBtn');
const registerBtn=document.getElementById('registerBtn');
const showRegister=document.getElementById('showRegister');
const showLogin=document.getElementById('showLogin');

const loginPhone=document.getElementById('loginPhone');
const loginPassword=document.getElementById('loginPassword');
const registerPhone=document.getElementById('registerPhone');
const registerPassword=document.getElementById('registerPassword');
const registerUsername=document.getElementById('registerUsername');

const myAccountBtn=document.getElementById('myAccountBtn');
const accountPage=document.getElementById('accountPage');
const accountPostsContainer=document.getElementById('accountPostsContainer');

const searchBtn=document.getElementById('searchBtn');
const searchContainer=document.getElementById('searchContainer');
const searchInput=document.getElementById('searchInput');
const searchResults=document.getElementById('searchResults');

let currentUser=null;
let currentCommentPost=null;

showRegister.addEventListener('click',()=>{loginContainer.style.display='none';registerContainer.style.display='flex';});
showLogin.addEventListener('click',()=>{registerContainer.style.display='none';loginContainer.style.display='flex';});

registerBtn.addEventListener('click', async ()=>{
let phone=registerPhone.value.trim();
let pass=registerPassword.value.trim();
let username=registerUsername.value.trim();
if(!phone||!pass||!username)return alert("Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
const snap=await get(ref(db,'users/'+phone));
if(snap.exists())return alert("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹");
await set(ref(db,'users/'+phone),{password:pass,username});
currentUser={phone,username};
loginContainer.style.display='none';
registerContainer.style.display='none';
loadPosts();
});

loginBtn.addEventListener('click', async ()=>{
let phone=loginPhone.value.trim();
let pass=loginPassword.value.trim();
if(!phone||!pass)return alert("Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
const snap=await get(ref(db,'users/'+phone));
if(!snap.exists())return alert("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
const userData=snap.val();
if(userData.password!==pass)return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©");
currentUser={phone,username:userData.username};
loginContainer.style.display='none';
registerContainer.style.display='none';
loadPosts();
});

newPostBtn.addEventListener('click',()=>{writePostContainer.style.display=writePostContainer.style.display==='flex'?'none':'flex';postInput.focus();});
publishBtn.addEventListener('click',async ()=>{
if(!currentUser)return alert("Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
let content=postInput.value.trim();
if(!content)return alert("Ø§Ù„Ù…Ù†Ø´ÙˆØ± ÙØ§Ø±Øº");
let post={content,user:currentUser.username,likes:0,shares:0,views:0,likedBy:{},comments:{}};
await push(ref(db,'posts'),post);
postInput.value='';
writePostContainer.style.display='none';
});

function createPostElement(postId,postData,container=postsContainer){
const postDiv=document.createElement('div');
postDiv.className='post';
postDiv.dataset.id=postId;
postDiv.innerHTML=`<div class="post-header">${postData.user}</div>
<div class="post-content">${postData.content}</div>
<div class="post-footer">
<button class="like-btn">â¤ <span class="like-count">${postData.likes||0}</span></button>
<button class="comment-btn">ğŸ’¬ <span class="comment-count">${postData.comments?Object.keys(postData.comments).length:0}</span></button>
<button class="view-btn" disabled>ğŸ‘ï¸ <span class="view-count">${postData.views||0}</span></button>
<button class="share-btn">ğŸ”— <span class="share-count">${postData.shares||0}</span></button>
</div>`;
container.prepend(postDiv);

const likeBtn=postDiv.querySelector('.like-btn');
const likeCount=postDiv.querySelector('.like-count');
const commentBtn=postDiv.querySelector('.comment-btn');
const commentCountSpan=postDiv.querySelector('.comment-count');
const shareBtn=postDiv.querySelector('.share-btn');
const shareCount=postDiv.querySelector('.share-count');
const viewCountSpan=postDiv.querySelector('.view-count');

likeBtn.addEventListener('click',()=>{
if(postData.likedBy && postData.likedBy[currentUser.phone])return;
postData.likes=(postData.likes||0)+1;
postData.likedBy[ currentUser.phone ]=true;
update(ref(db,'posts/'+postId),{likes:postData.likes,likedBy:postData.likedBy});
likeCount.textContent=postData.likes;
});

commentBtn.addEventListener('click',()=>{
currentCommentPost={id:postId,data:postData};
updateModalComments(postData);
commentModal.style.display='flex';
});

modalCommentBtn.addEventListener('click',async ()=>{
let text=modalCommentInput.value.trim();
if(!text || !currentCommentPost)return;
const commentRef=push(ref(db,`posts/${currentCommentPost.id}/comments`));
await commentRef.set({user:currentUser.username,text});
modalCommentInput.value='';
});

shareBtn.addEventListener('click',()=>{
postData.shares=(postData.shares||0)+1;
update(ref(db,'posts/'+postId),{shares:postData.shares});
shareCount.textContent=postData.shares;
alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©! (Ù…Ø­Ø§ÙƒØ§Ø©)");
});

const observer=new IntersectionObserver((entries,obs)=>{
entries.forEach(entry=>{
if(entry.isIntersecting){
postData.views=(postData.views||0)+1;
update(ref(db,'posts/'+postId),{views:postData.views});
viewCountSpan.textContent=postData.views;
obs.unobserve(postDiv);
}
});
},{threshold:0.5});
observer.observe(postDiv);
}

function updateModalComments(postData){
modalComments.innerHTML=postData.comments?Object.values(postData.comments).map(c=>`<div class="comment"><strong>${c.user}:</strong> ${c.text}</div>`).join(''):'';
}

closeModal.addEventListener('click',()=>commentModal.style.display='none');
window.addEventListener('click',e=>{if(e.target==commentModal)commentModal.style.display='none';});

function loadPosts(){
postsContainer.innerHTML='';
accountPostsContainer.innerHTML='';
onChildAdded(ref(db,'posts'),snapshot=>{
let post=snapshot.val();
createPostElement(snapshot.key,post);
if(currentUser && post.user===currentUser.username){
createPostElement(snapshot.key,post,accountPostsContainer);
}
});
}

myAccountBtn.addEventListener('click',()=>{
if(!currentUser)return alert("Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
accountPage.style.display='flex';
postsContainer.style.display='none';
searchContainer.style.display='none';
});

searchBtn.addEventListener('click',()=>{
searchContainer.style.display='flex';
postsContainer.style.display='none';
accountPage.style.display='none';
});
searchInput.addEventListener('input',async ()=>{
let val=searchInput.value.trim();
searchResults.innerHTML='';
if(!val)return;
const snap=await get(ref(db,'users'));
if(snap.exists()){
Object.values(snap.val()).forEach(u=>{
if(u.username.toLowerCase().includes(val.toLowerCase())){
const div=document.createElement('div');div.textContent=u.username;searchResults.appendChild(div);
}
});
}
});
</script>
</body>
    </html>
