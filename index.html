<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل الدخول / إنشاء حساب</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Cairo', sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
  background: linear-gradient(135deg, #6C63FF, #3A3D98);
}
.container {
  background:#fff;
  padding:40px 30px;
  border-radius:15px;
  width:350px;
  text-align:center;
  box-shadow:0 15px 25px rgba(0,0,0,0.2);
}
h2 { margin-bottom:25px; color:#3A3D98; }
input { width:100%; padding:12px; margin:10px 0; border-radius:8px; border:1px solid #ccc; font-size:16px; outline:none; }
input:focus { border-color:#6C63FF; box-shadow:0 0 5px #6C63FF; }
button { width:100%; padding:12px; margin-top:15px; border:none; border-radius:8px; background:#6C63FF; color:#fff; font-size:16px; cursor:pointer; transition:.3s; }
button:hover { background:#3A3D98; }
.toggle { margin-top:15px; cursor:pointer; color:#6C63FF; font-weight:bold; }
</style>
</head>
<body>

<div class="container">
  <h2 id="form-title">إنشاء حساب</h2>
  <input type="text" id="name" placeholder="الاسم">
  <input type="text" id="phone" placeholder="رقم الهاتف">
  <input type="password" id="password" placeholder="كلمة السر">
  <button id="submit-btn">إنشاء حساب</button>
  <div class="toggle" id="toggle-form">لديك حساب؟ تسجيل الدخول</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDVYoWats4bhKLbO8cu9hQ73WBjty-e5mA",
  authDomain: "aljj-28d36.firebaseapp.com",
  databaseURL: "https://aljj-28d36-default-rtdb.firebaseio.com",
  projectId: "aljj-28d36",
  storageBucket: "aljj-28d36.firebasestorage.app",
  messagingSenderId: "256012982420",
  appId: "1:256012982420:web:3a1541af04b99d658e7c81",
  measurementId: "G-43WH1GKJFC"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const formTitle = document.getElementById('form-title');
const nameInput = document.getElementById('name');
const phoneInput = document.getElementById('phone');
const passwordInput = document.getElementById('password');
const submitBtn = document.getElementById('submit-btn');
const toggleForm = document.getElementById('toggle-form');

let isLogin = false;
toggleForm.addEventListener('click', () => {
  isLogin = !isLogin;
  if(isLogin){
    formTitle.textContent = 'تسجيل الدخول';
    nameInput.style.display = 'none';
    submitBtn.textContent = 'تسجيل دخول';
    toggleForm.textContent = 'ليس لديك حساب؟ إنشاء حساب';
  } else {
    formTitle.textContent = 'إنشاء حساب';
    nameInput.style.display = 'block';
    submitBtn.textContent = 'إنشاء حساب';
    toggleForm.textContent = 'لديك حساب؟ تسجيل الدخول';
  }
});

if(localStorage.getItem('loggedInUser')){
  window.location.href = 'zol.html';
}

submitBtn.addEventListener('click', async () => {
  const name = nameInput.value.trim();
  const phone = phoneInput.value.trim();
  const password = passwordInput.value.trim();
  if(!phone || !password || (!isLogin && !name)){
    alert('يرجى ملء جميع الحقول!');
    return;
  }
  const userRef = ref(db, 'users/' + phone);
  if(isLogin){
    const snapshot = await get(userRef);
    if(snapshot.exists() && snapshot.val().password === password){
      localStorage.setItem('loggedInUser', JSON.stringify(snapshot.val()));
      window.location.href = 'zol.html';
    } else alert('رقم الهاتف أو كلمة السر غير صحيحة');
  } else {
    const snapshot = await get(userRef);
    if(snapshot.exists()) alert('الحساب موجود بالفعل');
    else {
      await set(userRef, {name, phone, password});
      localStorage.setItem('loggedInUser', JSON.stringify({name, phone}));
      alert('تم إنشاء الحساب بنجاح!');
      window.location.href = 'zol.html';
    }
  }
});
</script>
</body>
</html>
