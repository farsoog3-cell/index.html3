<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZOL</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">

<style>
body { font-family:'Cairo', sans-serif; margin:0; background:#f4f6f8; }
header { background:#6C63FF; color:#fff; padding:20px 40px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 4px 6px rgba(0,0,0,0.1);}
header h1 { margin:0; font-size:28px; }
header button { padding:10px 20px; font-size:16px; background:#fff; color:#6C63FF; border:none; border-radius:8px; cursor:pointer; transition:.3s; }
header button:hover { background:#3A3D98; color:#fff; }
main { padding:20px; min-height:calc(100vh - 80px); }
.post { background:#fff; margin-bottom:15px; padding:15px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.post h3 { margin:0 0 5px 0; }
.post p { margin:5px 0; }
.post small { color:gray; }
.post button { margin-left:5px; padding:5px 10px; font-size:12px; border:none; border-radius:5px; cursor:pointer; }
.post .edit-btn { background:#f0ad4e; color:#fff; }
.post .delete-btn { background:#d9534f; color:#fff; }

#addPostBtn { position:fixed; bottom:30px; right:30px; width:60px; height:60px; background:#6C63FF; color:#fff; border:none; border-radius:50%; font-size:36px; cursor:pointer; display:flex; justify-content:center; align-items:center; box-shadow:0 4px 8px rgba(0,0,0,0.2); transition:.3s; }
#addPostBtn:hover { background:#3A3D98; }

#postModal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
#postModal .modal-content { background:#fff; padding:20px; border-radius:10px; width:300px; }
#postModal input, #postModal textarea { width:100%; margin-bottom:10px; padding:10px; border-radius:5px; border:1px solid #ccc; outline:none; }
#postModal button { width:100%; padding:10px; background:#6C63FF; color:#fff; border:none; border-radius:5px; cursor:pointer; }
#postModal button:hover { background:#3A3D98; }

.comments { margin-top:10px; border-top:1px solid #eee; padding-top:10px; }
.comment { background:#f1f1f1; padding:5px 10px; margin-bottom:5px; border-radius:5px; }
.comment small { color:gray; }
.comment-input { display:flex; margin-top:5px; }
.comment-input input { flex:1; padding:5px 10px; border-radius:5px; border:1px solid #ccc; }
.comment-input button { padding:5px 10px; margin-left:5px; background:#6C63FF; color:#fff; border:none; border-radius:5px; cursor:pointer; }
</style>
</head>

<body>

<header>
  <h1>ZOL</h1>
  <button id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
</header>

<main id="postsContainer"></main>
<button id="addPostBtn">+</button>

<div id="postModal">
  <div class="modal-content">
    <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø´ÙˆØ±</h3>
    <input type="text" id="postTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´ÙˆØ±">
    <textarea id="postDesc" placeholder="Ø§Ù„ÙˆØµÙ" rows="4"></textarea>
    <button id="publishBtn">Ù†Ø´Ø±</button>
  </div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, set, push, onValue, remove, update, get } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDVYoWats4bhKLbO8cu9hQ73WBjty-e5mA",
  authDomain: "aljj-28d36.firebaseapp.com",
  databaseURL: "https://aljj-28d36-default-rtdb.firebaseio.com",
  projectId: "aljj-28d36",
  storageBucket: "aljj-28d36.firebasestorage.app",
  messagingSenderId: "256012982420",
  appId: "1:256012982420:web:3a1541af04b99d658e7c81",
  measurementId: "G-43WH1GKJFC"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
const currentUser = JSON.parse(localStorage.getItem("loggedInUser"));
if (!currentUser) window.location.href = "index.html";

const postsContainer = document.getElementById("postsContainer");
const addPostBtn = document.getElementById("addPostBtn");
const postModal = document.getElementById("postModal");
const publishBtn = document.getElementById("publishBtn");
const logoutBtn = document.getElementById("logoutBtn");

logoutBtn.onclick = () => {
  localStorage.removeItem("loggedInUser");
  window.location.href = "index.html";
};

addPostBtn.onclick = () => postModal.style.display = "flex";
postModal.onclick = (e) => { if (e.target === postModal) postModal.style.display = "none"; };


// ğŸ”¥ğŸ”¥ Ø§Ù„Ù†Ø´Ø± Ø§Ù„ØµØ­ÙŠØ­ 100%
publishBtn.onclick = async () => {
  const title = document.getElementById("postTitle").value.trim();
  const desc = document.getElementById("postDesc").value.trim();

  if (!title || !desc) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„");

  try {
    const postRef = push(ref(db, "posts"));
    await set(postRef, {
      title,
      desc,
      authorName: currentUser.name,
      authorPhone: currentUser.phone,
      views: 0,
      likes: 0,
      timestamp: Date.now()
    });

    alert("âœ” ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!");
    postModal.style.display = "none";
    document.getElementById("postTitle").value = "";
    document.getElementById("postDesc").value = "";

  } catch (err) {
    console.error(err);
    alert("âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±! ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„.");
  }
};


// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ù„Ù„Ø­Ø§Ø¦Ø·
function addPostToDOM(postId, post) {

  const div = document.createElement("div");
  div.className = "post";

  div.innerHTML = `
    <h3>${post.title}</h3>
    <p>${post.desc}</p>
    <small>Ø§Ù„ÙƒØ§ØªØ¨: ${post.authorName} | Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª: ${post.views}</small>
    <br>
  `;

  // Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ù„Ù„ÙƒØ§ØªØ¨ ÙÙ‚Ø·
  if (post.authorPhone === currentUser.phone) {
    const editBtn = document.createElement("button");
    editBtn.classList.add("edit-btn");
    editBtn.textContent = "ØªØ¹Ø¯ÙŠÙ„";

    editBtn.onclick = async () => {
      const newTitle = prompt("Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯", post.title);
      const newDesc = prompt("Ø§Ù„ÙˆØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯", post.desc);
      if (newTitle && newDesc) {
        await update(ref(db, "posts/" + postId), { title: newTitle, desc: newDesc });
      }
    };

    const delBtn = document.createElement("button");
    delBtn.classList.add("delete-btn");
    delBtn.textContent = "Ø­Ø°Ù";
    delBtn.onclick = () => remove(ref(db, "posts/" + postId));

    div.appendChild(editBtn);
    div.appendChild(delBtn);
  }

  postsContainer.prepend(div);
}


// ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
onValue(ref(db, "posts"), snapshot => {
  postsContainer.innerHTML = "";
  const data = snapshot.val();
  if (!data) return;

  Object.entries(data)
    .sort((a, b) => b[1].timestamp - a[1].timestamp)
    .forEach(([id, post]) => addPostToDOM(id, post));
});

</script>

</body>
</html>
